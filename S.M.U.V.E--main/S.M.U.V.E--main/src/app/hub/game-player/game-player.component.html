<div class="game-player-container" *ngIf="game; else loading">

  <div class="game-content-area">
    <div class="game-header">
      <button (click)="onClose()" class="close-button" title="Back to Hub">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Hub</span>
      </button>
      <h1 class="game-title futuristic-text-gradient animate__animated animate__fadeInDown animate__faster">{{ game.name }}</h1>
      <button (click)="toggleChatbot()" class="chatbot-toggle-button" title="Toggle S.M.U.V.E Assistant">
        <i class="fas fa-robot"></i>
      </button>
    </div>

    <div class="game-display-area animate__animated animate__fadeIn animate__delay-0.5s">
      <div class="cyber-vignette"></div>
      <div class="game-glow-effect"></div>
      
      <div class="game-iframe-wrapper">
        <iframe *ngIf="safeUrl" [src]="safeUrl" allowfullscreen class="game-iframe"></iframe>
        <div *ngIf="!safeUrl" class="iframe-placeholder">
          <p>Game URL is not available.</p>
        </div>
      </div>
    </div>

    <div class="game-details-bar animate__animated animate__fadeInUp animate__faster">
        <p class="game-description">{{ game.description }}</p>
    </div>
  </div>

  <div class="chatbot-wrapper" *ngIf="isChatbotVisible" [@slideIn]>
    <app-chatbot 
      [theme]="theme" 
      [mainViewMode]="mainViewMode" 
      (appCommand)="handleAppCommand($event)"
      (close)="toggleChatbot()">
    </app-chatbot>
  </div>

</div>

<ng-template #loading>
  <div class="loading-container">
    <div class="futuristic-spinner">
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
      <div class="spinner-blade"></div>
    </div>
    <p class="loading-text">Initializing Holo-Deck...</p>
  </div>
</ng-template>

<ng-template #error>
  <div class="error-container">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <p>Connection to game server lost. Please try again later.</p>
      <button (click)="onClose()" class="error-back-button">Return to Hub</button>
  </div>
</ng-template>
